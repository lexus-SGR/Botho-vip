<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Botho VIP - Pair Code & Session ID</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="container">
    <h1>ü§ñ Pair Code Generator & Session ID</h1>

    <input type="text" id="phone" placeholder="üìû Enter WhatsApp Number" required />
    <button onclick="generate()">üîó Generate Pair Code</button>

    <hr />

    <input type="text" id="code" placeholder="üî¢ Enter 8-digit Pair Code" />
    <button onclick="requestSessionId()">üì≤ Get Session ID</button>

    <p id="response"></p>
  </div>

  <script>
    function generateCode() {
      return Math.floor(10000000 + Math.random() * 90000000).toString();
    }

    async function generate() {
      const phone = document.getElementById('phone').value.trim();
      const code = generateCode();

      if (!phone.match(/^\d+$/)) {
        return document.getElementById('response').innerText = "‚ö†Ô∏è Invalid phone number";
      }

      const res = await fetch('/paircodes', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ code, phone }),
      });

      const data = await res.json();

      document.getElementById('response').innerHTML = `
        ‚úÖ <strong>Code:</strong> <code>${code}</code><br>
        üìû <strong>Phone:</strong> ${phone}<br>
        üì® <strong>Server Response:</strong><br>
        <pre>${JSON.stringify(data, null, 2)}</pre>
      `;
    }

    async function requestSessionId() {
      const code = document.getElementById('code').value.trim();
      const phone = document.getElementById('phone').value.trim();

      if (code.length !== 8) {
        return document.getElementById('response').innerText = "‚ö†Ô∏è Pair code must be exactly 8 digits";
      }
      if (!phone.match(/^\d+$/)) {
        return document.getElementById('response').innerText = "‚ö†Ô∏è Invalid phone number";
      }

      const res = await fetch('/get-session', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ code, phone }),
      });

      const data = await res.json();

      if (data.sessionId) {
        document.getElementById('response').innerHTML = `
          üîê <strong>Session ID:</strong><br>
          <code>${data.sessionId}</code>
        `;
      } else if (data.error) {
        document.getElementById('response').innerText = `‚ö†Ô∏è Error: ${data.error}`;
      } else {
        document.getElementById('response').innerText = "‚ö†Ô∏è Unknown server response";
      }
    }
  </script>
</body>
</html>
